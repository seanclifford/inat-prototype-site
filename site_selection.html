<!doctype html>

<html lang="en">
  <head>
    <meta charset="utf-8">
  
    <title>INat prototypes - Select default site</title>
    <meta name="description" content="Site selection prototype for INaturalist">
    <meta name="author" content="Sean Clifford">
  
    <link rel="stylesheet" href="css/styles.css?v=1.0">
  
  </head>
  
  <body>
    <h1>Select the iNaturalist site to use by default</h1>
    Changing this, will change the links on this site to point to the iNaturalist website you're normally logged into.<br>
    For most people, this will be the main inaturalist.org site (the first one).
    <div id="all_sites"></div>
    <br>
    <input type="button" id="apply_current_site" value="Apply changes" onclick="saveCurrentSite()">

    <script src="js/constants.js?v=1.0.0"></script>
    <script src="js/api.js?v=1.0.0"></script>
    <script src="js/site.js?v=1.0.0"></script>
    <script>
        (async () => {
            let allSites = await getAllSites();
            let currentSite = await getCurrentSite();
            
            allSites.forEach(site => {
                let isCurrent = site.id == currentSite.id;
                addSite(site, isCurrent);
            });
        })();
        
        function addSite(site, isCurrent) {
            let div = document.getElementById('all_sites');
            
            div.innerHTML += `<label>
              <input type="radio" name="selected_site" value='${site.id}' ${isCurrent?"checked":""}>
              <img width='30px' src='${site.icon_url}'> ${site.name}
            </label> &nbsp;&nbsp;
            <span style="font-size:70%">(<a href="${site.url}" target="_blank">${site.url}</a>)</span>
            <br/>`;
        }

        async function saveCurrentSite()
        {
            let selectedRadio = document.querySelector("input[name=selected_site]:checked");
            if (selectedRadio) {
                let currentSiteId = selectedRadio.value;
                await setCurrentSiteById(currentSiteId);
            }
            let currentSite = await getCurrentSite();
            alert(`This site will use ${currentSite.name} for iNaturalist interactions`);
            window.history.back();
        }
    </script>
  </body>
</html>