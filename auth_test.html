<!doctype html>

<html lang="en">
  <head>
    <meta charset="utf-8">
  
    <title>iNat prototypes - Auth test</title>
    <meta name="description" content="Authentication prototype for iNaturalist">
    <meta name="author" content="Sean Clifford">
  
    <link rel="stylesheet" href="css/styles.css?v=1.0">
  
  </head>
  
  <body>
    <h1>Testing page for authentication</h1>
    <div id="authenticated_user"></div>
    <br>
    <input type="button" id="authenticate" value="Log in / authenticate this site" onclick="Api.ensureAuthenticated()">
    <br>
    <br>
    <input type="button" id="logout" value="Logout" onclick="logout()">

    <script src="js/constants.js?v=1.0.0"></script>
    <script src="js/api.js?v=1.0.0"></script>
    <script src="js/auth.js?v=1.0.0"></script>
    <script src="js/site.js?v=1.0.0"></script>
    <script>
        (async () => {
            await populateAuthenticatedUser();
        })();
        
        async function populateAuthenticatedUser() {
            let div = document.getElementById('authenticated_user');
            
            let user = await getAuthenticatedUser();

            
            if (user) {
                div.innerHTML = "Logged in as: ";
                
                if (user.icon) {
                    div.innerHTML += `<img width='30' src='${user.icon}'> `;
                }

                name = user.login;
                if (user.name) {
                    name += ` - <i>${user.name}</i>`
                }
                div.innerHTML += name;
            }
            else {
                div.innerHTML = '<i>No user is authenticated</i>'
            }
        }

        async function logout() {
            clearAllAuthenticationState();
            await populateAuthenticatedUser();
        }
    </script>
  </body>
</html>