<!doctype html>

<html lang="en">
  <head>
    <meta charset="utf-8">
  
    <title>INat prototypes - Auth test</title>
    <meta name="description" content="Authentication prototype for INaturalist">
    <meta name="author" content="Sean Clifford">
  
    <link rel="stylesheet" href="css/styles.css?v=1.0">
  
  </head>
  
  <body>
    <h1>Testing page for authentication</h1>
    <input type="button" id="check" value="Check" onclick="populateAuthenticatedUser()">
    <div id="authenticated_user"></div>
    <br>
    <input type="button" id="authenticate" value="Authenticate!" onclick="authenticate()">

    <script src="js/constants.js?v=1.0.0"></script>
    <script src="js/api.js?v=1.0.0"></script>
    <script src="js/auth.js?v=1.0.0"></script>
    <script>
        /*(async () => {
            await populateAuthenticatedUser();
        })();*/
        
        async function populateAuthenticatedUser() {
            let div = document.getElementById('authenticated_user');
            
            let user = await getAuthenticatedUser();

            if (user) {
                div.innerHTML = `<img width='30px' src='${user.icon_url}'> ${user.name}`;
            }
            else {
                div.innerHTML = '<i>No user is authenticated</i>'
            }
        }

        async function getAuthenticatedUser() {
            const apiToken = await getApiToken();

            if (apiToken) {
                return await Api.getAuthenticatedUser(apiToken)
            } 

            return null;
        }

        async function authenticate()
        {
            Api.ensureAuthenticated();
        }
    </script>
  </body>
</html>