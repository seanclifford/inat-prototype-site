<!doctype html>

<html lang="en">
  <head>
    <meta charset="utf-8">
  
    <title>INat prototypes - Bulk Send Messages PROTOTYPE</title>
    <meta name="description" content="Bulk Send Messages prototype for INaturalist">
    <meta name="author" content="Sean Clifford">
  
    <link rel="stylesheet" href="css/styles.css?v=1.0">
  
    
  </head>
  
  <body>
    <h1>Bulk Send Messages prototype for INaturalist</h1>
    <h2>TODO:</h2>
    <ul>
      <li>Enter csv of user ids<br/>
        <input type="text" id="user_ids">
      </li>
      
      <li>
        <input type="button" value='GO' onclick='getUserIds()'>
        <div id='users_found'></div>
      </li>
      <li>Enter message <br/>
        <textarea id='message'></textarea>
      </li>
      <li>Enter user session token. Go to <a href='https://inaturalist.nz/users/api_token' target="_blank">this page</a>, copy the api_token value without quotes, and paste it below:<br/>
        <input type="text" id="auth_token">
      </li>
      <li><input type="button" value='GO' onclick='sendMessages()'></li>
    </ul>
  
    <script src="js/api.js"></script>
    <script>
      var userIds = [];
      async function getUserIds() {
          let input = document.getElementById("user_ids").value;
          let user = await Api.getUser(input)
          userIds.push(user);
          let div = document.getElementById('users_found');
          div.innerHTML = "<img src='"+user.icon+"'>"+ user.name
      }
      function sendMessages(){ 
        let subject = 'Test';
        let message = document.getElementById('message').value;
        let authToken = document.getElementById('auth_token').value;
        
        Promise.all(userIds.map(async (userId) => {
          await Api.sendMessage(userIds[0], subject, message, authToken);
        }));
      }
    </script>
  </body>
</html>